INCLUDE "engine_audio.inc"
INCLUDE "engine_graphics.inc"
INCLUDE "engine_lcd.inc"
INCLUDE "engine_memory.inc"
INCLUDE "engine_system.inc"

ENGINE_SYSTEM_WRAM
ENGINE_SYSTEM_HEADER_DMG_CGB Begin
ENGINE_GRAPHICS_PALLET_CGB_SET_ROUTINE
ENGINE_MEMORY_COPY_ROUTINE

Begin:
; Set stack pointer to top of WRAM
ENGINE_MEMORY_STACK_POINTER_SET
; Store system type
ENGINE_SYSTEM_TYPE_STORE
; Turn off audio to prevent "Screech of Death" when first loading up rom
ENGINE_AUDIO_SHUTDOWN
; Wait for VBlank (vertical blanking interval)
; VRAM, OAM, and LCD control registers are unsafe to  
; modify while the LCD is actively drawing scanlines.
ENGINE_LCD_VBLANK_WAIT
; Disable the LCD controller.
; This immediately halts rendering and allows unrestricted
; access to VRAM and OAM memory.
; Turning off outside of VBlank can permanently damage original gameboy hardware
ENGINE_LCD_MODE fENGINE_LCD_MODE_OFF
; Load defafault pallet : Default to DMG and upgrade if CGB is supported
ENGINE_GRAPHICS_PALLET_DMG_DEFAULT
ENGINE_SYSTEM_TYPE_IF_CGB .pallet_end
ENGINE_GRAPHICS_PALLET_CGB_SET Palette_Red
.pallet_end
; Set tileset | tilemap
ENGINE_GRAPHICS_TILESET_LOAD Tileset_HelloWorld, TilesetEnd_HelloWorld, vENGINE_GRAPHICS_TILESET1, Engine_Memory_Copy
ENGINE_GRAPHICS_TILEMAP_LOAD Tilemap_HelloWorld, TilemapEnd_HelloWorld, vENGINE_GRAPHICS_TILEMAP0, Engine_Memory_Copy
; Turn the LCD controller back on
; At this point:
; - Palette is set
; - Tiles are in VRAM
; - Tilemap is configured
ENGINE_LCD_MODE fENGINE_LCD_MODE_BG_SIGNED

Update:
ENGINE_LCD_VBLANK_WAIT
; Read input
; Update game state
; Write tileset data to VRAM
; Write tilemap data to VRAM
; Write OAM / sprite updates
ENGINE_LCD_VBLANK_END
jp Update

SECTION "data_game", ROM0

Palette_Red:
ENGINE_GRAPHICS_PALLET_DATA 30,28,26, 26,16,16, 18,4,4, 0,0,0
Palette_Green:
ENGINE_GRAPHICS_PALLET_DATA 30,28,26, 18,24,16, 6,14,6, 0,0,0
Palette_Blue:
ENGINE_GRAPHICS_PALLET_DATA 30,28,26, 16,18,26, 4,6,18, 0,0,0
Palette_Yellow:
ENGINE_GRAPHICS_PALLET_DATA 30,28,26, 28,24,10, 20,14,2, 0,0,0
Palette_Purple:
ENGINE_GRAPHICS_PALLET_DATA 30,28,26, 22,16,24, 12,4,14, 0,0,0
Palette_Orange:
ENGINE_GRAPHICS_PALLET_DATA 30,28,26, 28,18,8, 20,8,2, 0,0,0
Palette_Pink:
ENGINE_GRAPHICS_PALLET_DATA 30,28,26, 28,18,22, 20,8,12, 0,0,0
    
Tileset_HelloWorld:
dw `22222222, `22222222, `22222222, `22222222, `22222222, `22222222, `22222222, `22222222 ; $00
dw `22222222, `20000000, `20000000, `20000000, `20000000, `20000000, `20000000, `20000000 ; $01
dw `22222222, `02222220, `02222220, `02222220, `02222220, `02222220, `02222220, `02222220 ; $02
dw `22222222, `00000002, `00000002, `00000002, `00000002, `00000002, `00000002, `00000002 ; $03
dw `22222222, `00000000, `00000000, `00000000, `00000000, `00000000, `00000000, `00000000 ; $04
dw `22222222, `02222222, `02222222, `02222222, `02222222, `02222222, `02222222, `02222222 ; $05
dw `22222222, `22222211, `22222000, `22220000, `22200000, `22100000, `22000000, `21000000 ; $06
dw `22222222, `11222222, `00022222, `00002222, `00000222, `00000122, `00000022, `00000012 ; $07
dw `20000000, `20000000, `21111111, `20000000, `20000000, `21111111, `21111111, `20000000 ; $08
dw `02222220, `02323230, `13232321, `02323230, `03232320, `11111111, `11111111, `00000000 ; $09
dw `00000002, `00000002, `11111113, `00000002, `00000003, `11111112, `11111113, `00000002 ; $0a
dw `20000000, `30000000, `21111111, `30000000, `20000000, `31111111, `21111111, `30000000 ; $0b
dw `02222222, `02323232, `13232323, `02323232, `03232323, `11111111, `11111111, `00000000 ; $0c
dw `22222222, `32323232, `23232323, `32323232, `23232323, `11111232, `11111323, `00000232 ; $0d
dw `02222222, `02323232, `13232323, `02323232, `03232323, `12323232, `13232323, `02323232 ; $0e
dw `22222222, `32222222, `22222222, `32222222, `22222222, `32222222, `22222222, `32222222 ; $0f
dw `21000000, `20000000, `21111111, `20000000, `20000000, `21111111, `21111111, `20000000 ; $10
dw `00222200, `02222230, `12222321, `02223230, `02232320, `12323231, `12232321, `02323230 ; $11
dw `00000012, `00000002, `11111113, `00000002, `00000003, `11111112, `11111113, `00000002 ; $12
dw `22222222, `32222222, `23232222, `32323222, `23232222, `32323222, `23232322, `32323222 ; $13
dw `21111111, `21111111, `21111111, `21111111, `21111111, `21111111, `21111111, `21111111 ; $14
dw `11111111, `11111111, `11111111, `12323231, `13232321, `12323231, `13232321, `12323231 ; $15
dw `11111113, `11111112, `11111113, `11111112, `11111113, `11111112, `11111113, `11111112 ; $16
dw `21111111, `31111111, `21111111, `31111111, `21111111, `31111111, `21111111, `31111111 ; $17
dw `11111111, `11111111, `11111111, `12323232, `13232323, `12323232, `13232323, `12323232 ; $18
dw `11111222, `11111222, `11111222, `32222222, `22222222, `32323232, `23232323, `32323232 ; $19
dw `21111111, `21111111, `21111111, `21111111, `21111111, `31111111, `21111111, `31111111 ; $1a
dw `13232323, `12323232, `13232323, `12323232, `13232323, `12323232, `13232323, `12323232 ; $1b
dw `13232321, `12323231, `13232321, `12323231, `13232321, `12323231, `13232321, `11323211 ; $1c
dw `23232322, `32323232, `23232322, `32323232, `23232322, `32323232, `23232322, `32323232 ; $1d
dw `21111111, `21111111, `21111111, `21111111, `21111111, `21111111, `21111111, `22222222 ; $1e
dw `13232321, `12323231, `13232321, `12323231, `13232321, `12323231, `13232321, `22323232 ; $1f
dw `11111113, `11111112, `11111113, `11111112, `11111113, `11111112, `11111113, `32222222 ; $20
dw `21111111, `31111111, `21111111, `31111111, `21111111, `31111111, `21111111, `32323232 ; $21
dw `11111111, `11111111, `11111111, `11111111, `11111111, `11111111, `11111111, `22323232 ; $22
dw `11111113, `11111112, `11111113, `11111112, `11111112, `11111112, `11111112, `32222222 ; $23
dw `21111111, `31111111, `21111111, `21111111, `21111111, `21111111, `21111111, `22222222 ; $24
dw `11111112, `11111112, `11111112, `11111112, `11111112, `11111112, `11111112, `32222222 ; $25
dw `22111111, `22111111, `22111111, `22211111, `22211111, `22221111, `22222211, `22222222 ; $26
dw `11111123, `11111122, `11111123, `11111222, `11111223, `11112222, `11222223, `32222232 ; $27
dw `23232323, `02323230, `03232320, `02323230, `03232320, `02323230, `03232320, `02222220 ; $28
dw `22222223, `00000002, `00000003, `00000002, `00000003, `00000002, `00000003, `00000002 ; $29
dw `23232322, `32323110, `23230000, `32300000, `23100000, `32000000, `21000000, `21000000 ; $2a
dw `23232323, `00000000, `00000000, `00000000, `00000000, `00000000, `00000000, `00000000 ; $2b
dw `23232323, `01123232, `00002323, `00000232, `00000323, `00000032, `00000013, `00000012 ; $2c
dw `23232322, `30000000, `20000000, `30000000, `20000000, `30000000, `20000000, `20000000 ; $2d
dw `23232323, `00123232, `00001323, `00000132, `00000023, `00000012, `00000003, `00000002 ; $2e
dw `23232323, `02323232, `03232323, `02323232, `03232323, `02323232, `03232323, `02222222 ; $2f
dw `23232323, `32323232, `23232323, `32323232, `23232323, `32323232, `23232323, `22222222 ; $30
dw `22232323, `00000000, `00000000, `00000000, `00000000, `00000000, `00000000, `00000000 ; $31
dw `23232323, `01123232, `00001323, `00000132, `00000023, `00000012, `00000013, `00000002 ; $32
dw `23232322, `32323222, `23232322, `32323222, `23232222, `32322222, `23222222, `22222222 ; $33
dw `02222220, `02323230, `13232321, `02323230, `03232320, `12321231, `13211321, `02300230 ; $34
dw `02222200, `02323230, `13232321, `02323230, `03232300, `11111111, `11111111, `00000000 ; $35
dw `00000002, `00000002, `11111113, `00000012, `00000113, `11111132, `11111323, `00003232 ; $36
dw `02222200, `02323230, `13232321, `02323230, `03232320, `12323231, `13232321, `02323230 ; $37
dw `22222222, `32322222, `23232222, `32323222, `23232322, `32323222, `23232322, `32323232 ; $38
dw `13211121, `12111131, `13111121, `12111111, `11111111, `11111111, `11112111, `11123111 ; $39
dw `11111111, `11111111, `11111111, `12323211, `13232321, `12323231, `13232321, `12323231 ; $3a
dw `11111223, `11111122, `11111123, `11111112, `11111113, `11111112, `11111113, `11111112 ; $3b
dw `13232321, `12323231, `13232321, `12323231, `13232321, `12323231, `13232321, `12323211 ; $3c
dw `11132111, `11123211, `11232311, `11323211, `11232321, `12323231, `13232321, `22323232 ; $3d
dw `11111113, `11111112, `11111113, `11111112, `11111113, `11111112, `11111113, `32322232 ; $3e
dw `23111111, `32111111, `23111111, `32311111, `23211111, `32321111, `23232311, `32323232 ; $3f
dw `11111113, `11111122, `11111123, `11111122, `11111223, `11112222, `11222223, `32222232 ; $40
dw `23232323, `22323232, `23232323, `22323232, `23232323, `22323232, `23232323, `22222222 ; $41
dw `23222323, `32322232, `23222223, `32222232, `23222223, `32222222, `22222223, `22222222 ; $42
dw `23232322, `32323232, `23232322, `32323232, `23232322, `32323232, `23232322, `22222222 ; $43
dw `22232323, `22323232, `22232323, `22223232, `22232323, `22223232, `22222223, `22222222 ; $44
dw `22222223, `32222222, `22222223, `32222222, `22222223, `32222222, `22222223, `22222222 ; $45
TilesetEnd_HelloWorld:

Tilemap_HelloWorld:
; Original $00 becomes $80, $01 becomes $81, etc.
db $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$81,$82,$83,$81,$84,$83,$81,$85,$80,$81,$85,$80,$86,$84,$87,$80,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$88,$89,$8a,$8b,$8c,$8d,$8b,$8e,$8f,$88,$8e,$8f,$90,$91,$92,$93,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$94,$95,$96,$97,$98,$99,$9a,$9b,$8f,$94,$9b,$8f,$94,$9c,$96,$9d,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$9e,$9f,$a0,$a1,$a2,$a3,$a4,$a2,$a5,$9e,$a2,$a5,$a6,$a2,$a7,$9d,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$81,$a8,$a9,$aa,$ab,$ac,$ad,$ab,$ae,$ad,$af,$b0,$ad,$b1,$b2,$b3,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$88,$b4,$8a,$8b,$91,$8a,$8b,$b5,$b6,$8b,$8e,$8f,$88,$b7,$8a,$b8,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$94,$b9,$96,$97,$9c,$96,$97,$ba,$bb,$97,$9b,$8f,$94,$bc,$96,$9d,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$9e,$bd,$be,$bf,$a2,$a7,$a1,$9f,$a0,$a1,$a2,$a5,$9e,$a2,$c0,$9d,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$80,$c1,$c2,$c3,$c4,$b0,$b3,$c1,$c5,$c3,$c1,$b0,$c3,$c1,$b0,$b3,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
db $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80, $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80
TilemapEnd_HelloWorld: